<!DOCTYPE html>
<html>
<head>
    <title>Storing user details with CrudCrud and Axios</title>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <link rel="stylesheet" href="test.css">
</head>
<body>
    <div class="page-wrapper"></div>
    <label for="price">Price:</label>
    <input type="text" id="price">
    <br><br>
    <label for="product_name">Product name:</label>
    <input type="text" id="product_name">
    <br><br>
    <label for="category">Category:</label>
        <select id="category">
            <option value="electronics">Electronics</option>
            <option value="health">Health</option>
            <option value="skin_care">Skin Care</option>
        </select>
        <br><br>
          <button onclick="store()">Add Product</button>
        

        <div style="margin-bottom: 20px;">
        <h3>Filter Products:</h3>
        <label for="filter_price">Price:</label>
        <input type="number" id="filter_price" min="0" placeholder="0"><br><br>
        <label for="filter_category">Category:</label>
        <select id="filter_category">
            <option value="">All Categories</option>
            <option value="electronics">Electronics</option>
            <option value="health">Health</option>
            <option value="skin_care">Skin Care</option>
        </select>
        <button onclick="filterProducts()">  Filter</button>
        <button onclick="clearFilter()">  Clear Filter</button>
    </div>
        <h2>Products:</h2>
        <h3>Electronics Items:</h3>
        <div id="container1"></div>
        <h3>Health:</h3>
        <div id="container2"></div>
        <h3>Skin Care:</h3>
        <div id="container3"></div>
</div>

    <script type="text/javascript">
        const API_URL = 'https://crudcrud.com/api/cedaf4f1fc444b47a6d8285c9558e07e/product_details'; 
        
        // Filter state
        let currentFilter = {
            minPrice: '',
            category: ''
        };

        window.addEventListener("DOMContentLoaded", function () {
            loadAndDisplay();
        });

        function loadAndDisplay() {
            axios.get(API_URL)
                .then(response => {
                    display(response.data);
                })
                .catch((error) => {
                    console.error('Error:', error);
                });
        }

        function store() {
            let price = document.getElementById("price").value;
            let product_name = document.getElementById("product_name").value;
            let category = document.getElementById("category").value;

            if (!price || !product_name || !category) {
                alert('Please fill all fields');
                return;
            }

            let newProduct = {
                price: price,
                product_name: product_name,
                category: category
            };

            axios.post(API_URL, newProduct)
                .then(response => {
                    console.log('Success:', response.data);
                    document.getElementById("price").value = '';
                    document.getElementById("product_name").value = '';
                    loadAndDisplay();
                })
                .catch((error) => {
                    console.error(error);
                });
        }

        function remove(id) {
            if (confirm('Are you sure you want to delete this product?')) {
                axios.delete(`${API_URL}/${id}`)
                    .then(response => {
                        console.log('Success Deletion');
                        loadAndDisplay();
                    })
                    .catch((error) => {
                        console.error('Error:', error);
                    });
            }
        }

        function filterProducts() {
            currentFilter.minPrice = document.getElementById("filter_price").value;
            currentFilter.category = document.getElementById("filter_category").value;
            loadAndDisplay();
        }

        function clearFilter() {
            document.getElementById("filter_price").value = '';
            document.getElementById("filter_category").value = '';
            currentFilter.minPrice = '';
            currentFilter.category = '';
            loadAndDisplay();
        }

        function display(products) {
            // Clear all containers
            document.getElementById("container1").innerHTML = '';
            document.getElementById("container2").innerHTML = '';
            document.getElementById("container3").innerHTML = '';

            if (products && products.length > 0) {
                let filteredProducts = products.filter(product => {
                    // Filter by price
                    if (currentFilter.minPrice && product.price < parseFloat(currentFilter.minPrice)) {
                        return false;
                    }
                    // Filter by category
                    if (currentFilter.category && product.category !== currentFilter.category) {
                        return false;
                    }
                    return true;
                });

                filteredProducts.forEach(product => {
                    let id;
                    if(product.category == "electronics")
                        id = "container1";
                    else if(product.category == "health")
                        id = "container2"
                    else if(product.category == "skin_care")
                        id = "container3"
                    
                    let product_container = document.getElementById(id);
                    product_container.innerHTML += `
                        <li style="margin: 5px 0;"> 
                            ${product.price} - ${product.product_name} (${product.category})
                            <button onclick="remove('${product._id}')" style="margin-left: 10px;">Delete</button>
                        </li>`;
                });

                // Show filter info
                let filterText = '';
                if (currentFilter.minPrice || currentFilter.category) {
                    filterText = ` (Showing ${filteredProducts.length} of ${products.length} products)`;
                    document.querySelector('h2').innerHTML = `Products:${filterText}`;
                } else {
                    document.querySelector('h2').innerHTML = 'Products:';
                }
            } else {
                document.querySelector('h2').innerHTML = 'Products: (No products found)';
            }
        }
    </script>
</body>
</html>
